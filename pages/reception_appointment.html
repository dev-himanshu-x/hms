<div class="container-fluid" ng-controller="appointmen">
    <nav class="navbar navbar-expand-md border-bottom">
        <div class="container-fluid d-flex justify-content-between align-items-center flex-wrap">
            <a class="navbar-brand p-0" href="#">
                <img src="assets/logo.png" height="50" width="50" alt="App Logo">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavContent"
                aria-controls="navbarNavContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNavContent">
                <ul class="navbar-nav d-flex align-items-center flex-row gap-4 px-4">
                    <li class="nav-item">
                        <a class="nav-link text-muted fw-semibold" ui-sref="profile">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger fw-semibold" ng-click="logout()">Sign Out</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="mb-4 mt-3" ng-if="appointments.length > 0">
        <h1 class="fs-4 fw-bold">Appointments</h1>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
            <thead ng-if="appointments.length > 0">
                <tr class="table-primary">
                    <th scope="col">Doctor Name</th>
                    <th scope="col">Specialization</th>
                    <th scope="col">Patient Name</th>
                    <th scope="col">Date and Time</th>
                    <th scope="col">Reason</th>
                    <th scope="col">History</th>
                    <th scope="col">Status</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="appointment in appointments">
                    <td>
                        Dr. {{appointment.doctor_first_name}} {{appointment.doctor_last_name}}
                    </td>
                    <td>{{appointment.doctor_specialization_name}}</td>
                    <td>{{appointment.patient_first_name}} {{appointment.patient_last_name}}</td>
                    <td>{{appointment.appointment_date}} at {{appointment.appointment_time}}</td>
                    <td>{{appointment.reason_to_vist}}</td>
                    <td>{{appointment.patient_history}}</td>
                    <td>
                        <span ng-if="appointment.status === 'Rejected by receptionist'"
                            class="badge bg-danger text-white">{{appointment.status}}</span>
                        <span ng-if="appointment.status === 'Pending'"
                            class="badge bg-warning text-white">{{appointment.status}}</span>
                        <span ng-if="appointment.status === 'Accepted by receptionist' && user != 'Doctor'"
                            class="badge bg-success text-white">{{appointment.status}}</span>
                        <span ng-if="appointment.status === 'Accepted by receptionist' && user == 'Doctor'"
                            class="badge bg-primary text-white">{{appointment.status}}</span>
                        <span ng-if="appointment.status === 'Accepted by doctor' && user == 'Doctor'"
                            class="badge bg-success text-white">{{appointment.status}}</span>
                        <span ng-if="appointment.status === 'Consulted'"
                            class="badge bg-success text-white">{{appointment.status}}</span>
                    </td>
                    <td>
                        <div ng-if="(user == 'Doctor' && appointment.status === 'Accepted by doctor')"
                            class="d-flex gap-2">
                            <button data-bs-toggle="modal" data-bs-target="#acceptModal"
                                ng-if="appointment.status === 'Accepted by doctor'"
                                class="btn-primary fw-semibold btn-small btn" type="submit">Consult</button>
                            <div class="modal fade" id="acceptModal" tabindex="-1" aria-labelledby="reject"
                                data-bs-backdrop="static" data-bs-keyboard="false">
                                <div class="modal-dialog modal-md">
                                    <div class="modal-content">
                                        <div class="modal-header text-dark">
                                            <h5 class="modal-title">Prescription</h5>
                                        </div>
                                        <div class="modal-body">
                                            <textarea type="text" placeholder="Explain reason" required
                                                class="form-control" id="pre" pattern="[A-Za-z_ ]{1,50}"></textarea>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                                ng-click="clear()">Close</button>
                                            <button type="submit" class="btn btn-primary"
                                                ng-click="consult(appointment.id)">Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div ng-if="appointment.status === 'Pending' || (user == 'Doctor' && appointment.status === 'Accepted by receptionist')"
                            class="d-flex gap-2">
                            <button ng-click="approve(appointment.id)" class="btn btn-success fw-semibold btn-sm"
                                type="button">Approve</button>
                            <button type="button" class="btn btn-danger fw-semibold btn-sm" data-bs-toggle="modal"
                                data-bs-target="#rejectModal">Reject</button>
                            <div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="reject"
                                data-bs-backdrop="static" data-bs-keyboard="false">
                                <div class="modal-dialog modal-md">
                                    <div class="modal-content">
                                        <div class="modal-header text-dark">
                                            <h5 class="modal-title" id="reject">Appointment rejection reason</h5>
                                        </div>
                                        <div class="modal-body">
                                            <textarea type="text" placeholder="Explain reason" required
                                                class="form-control" id="reason" pattern="[A-Za-z_ ]{1,50}"></textarea>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                                ng-click="clear()">Close</button>
                                            <button type="submit" class="btn btn-primary"
                                                ng-click="reject(appointment.id)">Submit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <div ng-if="appointments.length === 0">
            <p class="text-center text-danger fs-3 py-3">No appointments to display.</p>
        </div>
    </div>
</div>